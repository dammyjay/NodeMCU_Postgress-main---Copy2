<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Calicare Admin Dashboard</title>
  <link rel="stylesheet" href="/main.css">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; }
    .sidebar {
      width: 250px; background: #2c3e50; color: white; height: 100vh;
      position: fixed; padding: 20px;
    }
    .sidebar h2 { color: #ecf0f1; }
    .sidebar ul { list-style: none; padding: 0; }
    .sidebar ul li { margin: 20px 0; }
    .sidebar ul li a { color: white; text-decoration: none; }
    .main { margin-left: 270px; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    th { background-color: #f4f4f4; }
    button { padding: 6px 12px; }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Calicare Admin</h2>
    <ul>
      <li><a href="#">Dashboard</a></li>
      <li><a href="#">Users</a></li>
      <li><a href="#">Devices</a></li>
      <li><a href="#">Settings</a></li>
      <li><a href="/logout">Logout</a></li>
    </ul>
  </div>

  <div class="main">
    <h1>Admin Dashboard</h1>

    <h2>Users</h2>
    <table id="users-table">
      <thead>
        <tr>
            <th>ID</th>
            <th>Profile Picture</th>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Gender</th>
            <th>Edit</th>
            <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- Data will be loaded by JavaScript -->
      </tbody>
    </table>
  </div>

  <script>
//     const profilePic = user.profile_picture
//   ? user.profile_picture
//   : "profile.webp";

    async function loadUsers() {
      const res = await fetch('/admin/users');
      const users = await res.json();
      const tbody = document.querySelector('#users-table tbody');
      tbody.innerHTML = '';
      users.forEach(user => {
        tbody.innerHTML += `
          <tr>
            <td>${user.id}</td>
             <td>
                <img src="${user.profile_picture ? user.profile_picture : 'profile.webp'}"
                    alt="Profile Picture"
                    style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">
            </td>
            <td>${user.username}</td>
            <td>${user.email}</td>
            <td>${user.role}</td>
            <td>${user.gender}</td>
            <td>
              <button onclick="editUser(${user.id})">Edit Role</button>

            <td>
              <button onclick="deleteUser(${user.id})">Delete</button>
            </td>
          </tr>
        `;
      });
    }

    async function deleteUser(id) {
      if (!confirm("Are you sure you want to delete this user?")) return;
      await fetch('/admin/users/' + id, { method: 'DELETE' });
      loadUsers();
    }

    async function addUser() {
      const name = prompt("Enter user name:");
      const email = prompt("Enter user email:");
      const role = prompt("Enter user role:");
    }

    async function editUser(id) {
        const name = prompt("Enter new username:");
        const email = prompt("Enter new email:");
        const role = prompt("Enter new role (user/admin):");

        if (!name || !email || !role) return alert("All fields are required.");

        await fetch('/admin/users/' + id, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username: name, email, role })
        });

        loadUsers(); // reload table
        }


    loadUsers();
  </script>
</body>
</html>
